---
description: Background context for the project so far
globs: 
alwaysApply: false
---
Background context for the project so far

Task

1. Current Work: The project aims to build a unified web app and Chrome extension for video-based lectures, featuring audio/video capture, transcription, AI note generation, and various output formats. **MAJOR MILESTONE: The core web application has been successfully deployed to production with a fully functional upload system, direct S3 uploads, and end-to-end processing pipeline.**

Key implemented and production-ready features include:

- **Advanced File Upload System:** Fully functional upload page (`/dashboard/upload`) with direct browser-to-S3 upload capability, supporting files up to 200MB. Includes fallback mechanisms and proper error handling.
- **Direct S3 Upload Pipeline:** Implemented presigned URL generation (`/api/upload-url`) and post-upload processing (`/api/upload-complete`) for efficient large file handling that bypasses server size limits.
- **Robust Database Layer:** Supabase backend with proper Row Level Security (RLS) policies, user authentication, and real-time subscriptions. All security vulnerabilities have been identified and fixed.
- **AWS Lambda Integration:** Fully functional transcription (OpenAI Whisper) and AI note generation (OpenAI GPT-4o-mini) Lambda functions with proper error handling and status tracking.
- **Production Deployment:** Successfully deployed to AWS Amplify with all environment variables properly configured and CORS policies correctly set up.
- **Real-time Analysis Page:** Dynamic analysis page (`/dashboard/analysis/[id]`) with live updates via Supabase Realtime, media playback, transcription display, and markdown-formatted notes.
- **Complete Database Schema:** Optimized schema with `videos`, `transcripts`, `notes`, `lessons`, and `user_settings` tables, including proper relationships and data flow.

2. Key Technical Concepts:

- **Frontend:** Next.js 14 (App Router, API Routes, Server/Client Components), React (State, Hooks), `react-markdown`, Supabase Client (`@supabase/supabase-js`, `@supabase/ssr`), Direct S3 uploads with XMLHttpRequest, Progress tracking, CORS handling.
- **Backend:** Next.js API Routes, Supabase (Auth, PostgreSQL with RLS, Realtime), AWS S3 (direct uploads, presigned URLs), AWS Lambda (Python), AWS SDKs (`@aws-sdk/client-s3`, `@aws-sdk/client-lambda`), OpenAI API integration.
- **Database:** PostgreSQL with Row Level Security policies, proper user data isolation, enum constraints, foreign key relationships, and real-time subscriptions.
- **Infrastructure:** AWS Amplify (production hosting), S3 CORS configuration, IAM permissions, Lambda environment variables, Supabase project configuration.

3. Relevant Files and Code Structure:

- `src/app/api/upload-url/route.ts`: **PRODUCTION-READY** - Generates presigned S3 URLs with comprehensive environment variable validation and error handling.
- `src/app/api/upload-complete/route.ts`: **PRODUCTION-READY** - Handles post-upload processing, Lambda invocation, and credit consumption.
- `src/app/api/upload/route.ts`: **LEGACY/FALLBACK** - Original server upload route, maintained as fallback for CORS issues.
- `src/app/api/media/[videoId]/route.ts`: **PRODUCTION-READY** - Fetches media data with transcripts and notes, includes proper S3 URL generation.
- `src/app/dashboard/upload/page.tsx`: **PRODUCTION-READY** - Advanced upload interface with direct S3 upload, progress tracking, and lesson management.
- `src/app/dashboard/analysis/[id]/page.tsx`: **PRODUCTION-READY** - Real-time analysis page with media playback, transcription, and markdown notes display.
- `lambda_function-audio_tran.py`: **PRODUCTION-READY** - Transcription Lambda with error handling and status updates.
- `lambda_function-note_gen.py`: **PRODUCTION-READY** - Note generation Lambda with segmented content and markdown output.

4. Major Problem Solving Achievements:

- **Fixed Upload Size Limits:** Implemented direct S3 uploads to bypass 50MB server limits, now supporting 200MB files.
- **Resolved JSON Parsing Errors:** Fixed 413 error handling and response parsing in upload system.
- **Database Security Overhaul:** Fixed Row Level Security policies across all tables, preventing unauthorized data access.
- **Environment Variable Management:** Implemented comprehensive validation and debugging for AWS credentials in production.
- **CORS Configuration:** Properly configured S3 bucket CORS policies and Next.js API headers for cross-origin requests.
- **Production Deployment:** Successfully resolved AWS Amplify environment variable loading and S3 permissions issues.
- **Database Enum Constraints:** Fixed enum value mismatches in processing status fields.
- **Real-time Updates:** Implemented Supabase Realtime for live status updates during processing.

5. Production Environment:

- **Hosting:** AWS Amplify with automatic deployments
- **Environment Variables:** All AWS, Supabase, and Stripe credentials properly configured
- **File Storage:** Direct S3 uploads with proper CORS and IAM permissions
- **Database:** Supabase with RLS policies and real-time subscriptions
- **Processing:** AWS Lambda functions for transcription and note generation
- **Status:** **FULLY OPERATIONAL** âœ…

6. Current State and Next Steps:

**âœ… COMPLETED CORE FEATURES:**
- File upload system with direct S3 uploads (up to 200MB)
- User authentication and authorization
- Database with proper security policies
- Transcription pipeline (OpenAI Whisper)
- AI note generation (GPT-4o-mini)
- Real-time analysis page with media playback
- Markdown-formatted note display
- Production deployment on AWS Amplify

**ðŸ”„ NEXT PRIORITY FEATURES:**
- **Note Customization/Editing:** Add UI and backend for users to edit generated notes
- **Enhanced Notes Display:** Improve "Summary" and "Key Points" tab logic beyond placeholder content
- **Metadata Management:** Implement course title, professor, date, and tags for lessons
- **Export Formats:** Complete LaTeX, Word (.docx), and plain text export functionality
- **Video Capture:** Direct browser-based video recording capability
- **Progress Indicators:** More granular real-time feedback during processing

**ðŸš€ FUTURE ENHANCEMENTS:**
- **Chrome Extension:** Browser extension for direct lecture platform integration
- **Visual Context Extraction:** Analyze on-screen visuals and integrate descriptions
- **Stripe Integration:** Payment processing for subscriptions and billing
- **Advanced Analytics:** Usage tracking and performance monitoring
- **Mobile Optimization:** Responsive design improvements
- **Collaboration Features:** Note sharing and collaborative editing

**ðŸ”§ TECHNICAL DEBT:**
- Refactor legacy upload route (currently kept as fallback)
- Optimize database queries for larger datasets
- Implement comprehensive error logging and monitoring
- Add automated testing suite
- Improve TypeScript coverage

The project has achieved a significant milestone with a fully functional production web application. The core video upload, transcription, and note generation pipeline is working end-to-end. The next phase focuses on user experience enhancements and advanced features to differentiate the product in the educational technology market.